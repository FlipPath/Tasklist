<script src="http://js.pusherapp.com/1.6/pusher.min.js"></script>
<script>
  var socket = new Pusher("<%= Pusher.key %>");
  socket.bind("connection_established", function(evt){
    $(document).bind("ajax:before", function(xhr){
      if (xhr.target.nodeName == "FORM") {
        $("<input />").attr({ type: "hidden", name: "socket_id" }).
          val(evt.socket_id).appendTo(xhr.target);
      }
    });
  });
</script>